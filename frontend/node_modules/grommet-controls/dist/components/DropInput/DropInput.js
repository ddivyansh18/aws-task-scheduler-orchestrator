var __rest = (this && this.__rest) || function (s, e) {
    var t = {};
    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)
        t[p] = s[p];
    if (s != null && typeof Object.getOwnPropertySymbols === "function")
        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {
            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))
                t[p[i]] = s[p[i]];
        }
    return t;
};
import React, { Component } from 'react';
import { findDOMNode } from 'react-dom';
import { ThemeContext } from 'styled-components';
import { FormDown } from 'grommet-icons/icons/FormDown';
import { DropButton, Keyboard, Button } from 'grommet';
import { StyledDropInput, StyledDropInputContainer, StyledWidgetsContainer, } from './StyledDropInput';
/**
 *  An Input control with an optional drop button with the specified 'dropContent' or widgets<br/>
 *`import { DropInput } from 'grommet-controls';`<br/>
 *`<DropInput`<br/>
 *&nbsp;&nbsp;`dropContent={(`<br/>
 *&nbsp;&nbsp;&nbsp;&nbsp;`...`<br/>
 *&nbsp;&nbsp;`]}`<br/>
 *`/>`<br/>
 */
class DropInput extends Component {
    constructor() {
        super(...arguments);
        this.state = { open: false };
        this.inputRef = React.createRef();
        this.onUpdateValue = value => {
            const { onChange } = this.props;
            // eslint-disable-next-line react/no-find-dom-node
            const input = findDOMNode(this.inputRef.current);
            input.value = value;
            this.setState({ open: false, value });
            if (onChange) {
                onChange({ target: input });
            }
        };
        this.onOpen = e => {
            const { onOpen, disabled } = this.props;
            this.setState({ open: true });
            if (onOpen && !disabled) {
                onOpen(e);
            }
        };
        this.onClose = e => {
            const { onClose, disabled } = this.props;
            this.setState({ open: false });
            if (onClose && !disabled) {
                onClose(e);
            }
        };
        this.onKeyDown = e => {
            const { onKeyDown } = this.props;
            this.setState({ open: true });
            if (onKeyDown) {
                onKeyDown(e);
            }
        };
        this.onKeyUp = e => {
            const { onKeyUp } = this.props;
            this.setState({ open: false });
            if (onKeyUp) {
                onKeyUp(e);
            }
        };
    }
    static getDerivedStateFromProps(newProps, oldState) {
        if (newProps.value !== oldState.value ||
            newProps.defaultValue !== oldState.defaultValue) {
            return {
                value: newProps.value,
                defaultValue: newProps.defaultValue,
                open: false,
            };
        }
        return null;
    }
    render() {
        const _a = this.props, { a11yTitle, a11yDropTitle, dropAlign, dropTarget, update, widgets, 
        // eslint-disable-next-line @typescript-eslint/no-unused-vars
        onOpen, 
        // eslint-disable-next-line @typescript-eslint/no-unused-vars
        onClose, 
        // eslint-disable-next-line @typescript-eslint/no-unused-vars
        onKeyDown, 
        // eslint-disable-next-line @typescript-eslint/no-unused-vars
        onKeyUp, defaultValue, dropContent, dropIcon, disabled } = _a, rest = __rest(_a, ["a11yTitle", "a11yDropTitle", "dropAlign", "dropTarget", "update", "widgets", "onOpen", "onClose", "onKeyDown", "onKeyUp", "defaultValue", "dropContent", "dropIcon", "disabled"]);
        const { open } = this.state;
        if (typeof update === 'function') {
            update(this.onUpdateValue);
        }
        const numWidgets = (dropContent ? 1 : 0) + (widgets ? widgets.length : 0);
        let decorations;
        if (numWidgets > 0) {
            let drop;
            if (dropContent) {
                drop = (React.createElement(DropButton, { a11yTitle: a11yDropTitle, disabled: disabled, dropAlign: dropAlign, dropTarget: dropTarget, open: open, tabIndex: -1, focusIndicator: false, onOpen: this.onOpen, onClose: this.onClose, dropContent: dropContent, icon: dropIcon }));
            }
            decorations = (React.createElement(StyledWidgetsContainer, { align: "center", direction: "row" },
                widgets.map((widget, index) => (React.createElement(Button, Object.assign({ disabled: disabled, tabIndex: -1, key: `widget_${index}` }, widget)))),
                drop));
        }
        return (React.createElement(Keyboard, { onDown: this.onKeyDown, onUp: this.onKeyUp },
            React.createElement(StyledDropInputContainer, null,
                React.createElement(ThemeContext.Consumer, null, theme => (React.createElement(StyledDropInput, Object.assign({ ref: this.inputRef, theme: theme, disabled: disabled, numWidgets: numWidgets, "aria-label": a11yTitle, defaultValue: defaultValue ? defaultValue.toString() : undefined }, rest)))),
                decorations)));
    }
}
DropInput.defaultProps = {
    dropAlign: { top: 'bottom', right: 'left' },
    dropIcon: React.createElement(FormDown, null),
    type: 'text',
    widgets: [],
};
export { DropInput };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiRHJvcElucHV0LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vc3JjL2NvbXBvbmVudHMvRHJvcElucHV0L0Ryb3BJbnB1dC50c3giXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7QUFBQSxPQUFPLEtBQUssRUFBRSxFQUFFLFNBQVMsRUFBRSxNQUFNLE9BQU8sQ0FBQztBQUN6QyxPQUFPLEVBQUUsV0FBVyxFQUFFLE1BQU0sV0FBVyxDQUFDO0FBQ3hDLE9BQU8sRUFBRSxZQUFZLEVBQUUsTUFBTSxtQkFBbUIsQ0FBQztBQUNqRCxPQUFPLEVBQUUsUUFBUSxFQUFFLE1BQU0sOEJBQThCLENBQUM7QUFDeEQsT0FBTyxFQUFFLFVBQVUsRUFBRSxRQUFRLEVBQUUsTUFBTSxFQUFFLE1BQU0sU0FBUyxDQUFDO0FBRXZELE9BQU8sRUFDTCxlQUFlLEVBQ2Ysd0JBQXdCLEVBQ3hCLHNCQUFzQixHQUN2QixNQUFNLG1CQUFtQixDQUFDO0FBUTNCOzs7Ozs7OztHQVFHO0FBQ0gsTUFBTSxTQUFVLFNBQVEsU0FBMkM7SUFBbkU7O1FBUUUsVUFBSyxHQUFvQixFQUFFLElBQUksRUFBRSxLQUFLLEVBQUUsQ0FBQztRQUV6QyxhQUFRLEdBQUcsS0FBSyxDQUFDLFNBQVMsRUFBb0IsQ0FBQztRQW1CL0Msa0JBQWEsR0FBRyxLQUFLLENBQUMsRUFBRTtZQUN0QixNQUFNLEVBQUUsUUFBUSxFQUFFLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQztZQUNoQyxrREFBa0Q7WUFDbEQsTUFBTSxLQUFLLEdBQUcsV0FBVyxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsT0FBTyxDQUFxQixDQUFDO1lBQ3JFLEtBQUssQ0FBQyxLQUFLLEdBQUcsS0FBSyxDQUFDO1lBQ3BCLElBQUksQ0FBQyxRQUFRLENBQUMsRUFBRSxJQUFJLEVBQUUsS0FBSyxFQUFFLEtBQUssRUFBRSxDQUFDLENBQUM7WUFDdEMsSUFBSSxRQUFRLEVBQUU7Z0JBQ1osUUFBUSxDQUFD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